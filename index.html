<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Medium Articles</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.6.2/dist/axios.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const App = () => {
      const [articles, setArticles] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      // Parsing parameters from URL
      const params = window.location.pathname.split('/').filter(Boolean);
      const username = params[1] || 'medium'; // Default
      const articleIndex = parseInt(params[2]) || 1; // Default 1
      const articleFormat = params[3] || 'horizontal'; // Default horizontal

      useEffect(() => {
        const fetchArticles = async () => {
          try {
            setLoading(true);
            const response = await axios.get(
              `https://api.rss2json.com/v1/api.json?rss_url=https://medium.com/feed/@${username}`
            );
            const fetchedArticles = response.data.items.slice(0, articleIndex);
            setArticles(fetchedArticles);
          } catch (err) {
            setError('Error loading articles. Check your username or try again later.');
          } finally {
            setLoading(false);
          }
        };
        fetchArticles();
      }, [username, articleIndex]);

      const ArticleCard = ({ article, format }) => {
        const isHorizontal = format === 'horizontal';
        return (
          <div className={`p-4 m-4 bg-white rounded-lg shadow-md ${isHorizontal ? 'flex' : 'flex flex-col'}`}>
            {article.thumbnail && (
              <img
                src={article.thumbnail}
                alt={article.title}
                className={`object-cover ${isHorizontal ? 'w-1/3 h-40 mr-4' : 'w-full h-48 mb-4'} rounded`}
              />
            )}
            <div className="flex-1">
              <h2 className="text-xl font-bold mb-2">
                <a href={article.link} target="_blank" rel="noopener noreferrer">{article.title}</a>
              </h2>
              <p className="text-gray-600 mb-2">{new Date(article.pubDate).toLocaleDateString()}</p>
              <p className="text-gray-700">{article.description.replace(/<[^>]+>/g, '').slice(0, 150)}...</p>
            </div>
          </div>
        );
      };

      return (
        <div className="container mx-auto p-4">
          <h1 className="text-3xl font-bold text-center mb-6">Latest Medium Articles for @{username}</h1>
          {loading && <p className="text-center">Loading...</p>}
          {error && <p className="text-center text-red-500">{error}</p>}
          {articles.length === 0 && !loading && !error && (
            <p className="text-center">Articles not found.</p>
          )}
          <div className={articleFormat === 'horizontal' ? 'flex flex-col' : 'grid grid-cols-1 md:grid-cols-2 gap-4'}>
            {articles.map((article, index) => (
              <ArticleCard key={index} article={article} format={articleFormat} />
            ))}
          </div>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>

</html>